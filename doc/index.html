<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>SSH Chart (from .mm)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font-family: Segoe UI, Arial, sans-serif; margin: 24px; line-height: 1.5; color: #222; }
  h1 { margin-bottom: 0.4rem; }
  .small { color: #666; font-size: 0.9em; }
  .tree { margin-top: 1rem; }
  .node { margin: 4px 0; }
  .node > .label { cursor: pointer; display: inline-block; padding: 2px 6px; border-radius: 4px; }
  .node .children { margin-left: 20px; display: none; }
  .node.expanded > .children { display: block; }
  a { color: #1976d2; text-decoration: none; }
  a:hover { text-decoration: underline; }
  .anchor { opacity: 0.3; margin-left: 6px; text-decoration: none; }
  .anchor:hover { opacity: 1; }
</style>
</head>
<body>
<h1>SSH Chart</h1>
<p class="small">Tip: Click a label to expand/collapse. Links open in a new tab. Use the <code>#</code> to deep-link to any node.</p>
<div id="tree" class="tree"></div>
<script>
  // Fetch the .mm file from your repo
  fetch('../charts/SSH_chart.mm')
    .then(r => r.text())
    .then(xmlText => {
      const parser = new DOMParser();
      const xml = parser.parseFromString(xmlText, 'application/xml');

      // Build the tree HTML
      function esc(s) { const div = document.createElement('div'); div.textContent = s || ''; return div.innerHTML; }

      function renderNode(node, isRoot=false) {
        const id = node.getAttribute('ID') || '';
        const text = (node.getAttribute('TEXT') || '').trim();
        const link = node.getAttribute('LINK');
        const label = `<span class="label">${esc(text || '(no text)')}</span>` +
          (link ? ` <span class="small">[${esc(link)}link</a>]</span>` : '') +
          (id ? ` #${esc(id)}#</a>` : '');
        const children = [...node.querySelectorAll(':scope > node')].map(ch => renderNode(ch)).join('');
        const cls = isRoot ? 'node root' : 'node';
        const idAttr = id ? ` id="${esc(id)}"` : '';
        return `<div class="${cls}"${idAttr}>${label}<div class="children">${children}</div></div>`;
      }

      const roots = [...xml.querySelectorAll('map > node')].map(n => renderNode(n, true)).join('');
      document.getElementById('tree').innerHTML = roots;

      // Interactivity: toggle expand/collapse and deep-linking
      document.querySelectorAll('.label').forEach(lbl => {
        lbl.addEventListener('click', (e) => {
          if (e.target.tagName.toLowerCase() === 'a') return;
          const node = e.currentTarget.closest('.node');
          node.classList.toggle('expanded');
          const id = node.getAttribute('id');
          if (id) history.replaceState(null, '', '#' + id);
        });
      });

      // Expand root nodes by default
      document.querySelectorAll('.node.root').forEach(n => n.classList.add('expanded'));

      // If a hash is present, expand to that node
      const hash = location.hash.replace('#', '');
      if (hash) {
        const target = document.getElementById(hash);
        if (target) {
          let p = target.parentElement;
          while (p) {
            if (p.classList && p.classList.contains('node')) p.classList.add('expanded');
            p = p.parentElement;
          }
          target.classList.add('expanded');
          target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }
    });
</script>
</body>
</html>
